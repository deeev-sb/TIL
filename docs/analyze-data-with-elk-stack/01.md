# 01. Elasticsearch ì„¤ì¹˜ ë° CRUD

## 01. Elasticsearch ì„¤ì¹˜
ElasticsearchëŠ” ì•„ë˜ ë§í¬ì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.

ğŸ‘‰ [Elasticsearch ì„¤ì¹˜ ë§í¬](https://www.elastic.co/kr/downloads/elasticsearch)

í˜„ ì‹œì  (2023.03.22) ìµœì‹  ë²„ì „ì€ `8.6.2`ì´ë©°, Apache License 2.0ì˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ì´ìš©í•˜ê¸¸ ë°”ë¼ë©´ `7.10.2` ë²„ì „ì„ ì„¤ì¹˜í•˜ê¸¸ ë°”ë€ë‹¤. ì°¸ê³ ë¡œ, 7.11 ë²„ì „ë¶€í„°ëŠ” ë¼ì´ì„¼ìŠ¤ê°€ ë³€ê²½ë˜ì—ˆë‹¤.

ì°¸ê³ ë¡œ, 7.x ë²„ì „ë¶€í„°ëŠ” ìë°” ê°€ìƒ ë¨¸ì‹ ì´ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ë‚´ì— ë‚´ì¥ë˜ì–´ ìˆì–´ì„œ ë³„ë„ë¡œ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ìœ¼ë‚˜, ë¡œê·¸ìŠ¤íƒœì‹œë¥¼ ì´ìš©í•˜ë ¤ëŠ” ê²½ìš° ìë°” ê°€ìƒ ë¨¸ì‹ ì´ í•„ìš”í•˜ë‹¤. ì§€ì› ë²„ì „ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ì•„ë˜ ë§í¬ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ğŸ‘‰ [ì§€ì› ë²„ì „ í™•ì¸í•˜ëŸ¬ ê°€ê¸°](https://www.elastic.co/kr/support/matrix#matrix_compatibility)

### Windows í™˜ê²½ì— Elasticsearch ì„¤ì¹˜í•˜ê¸°

Windowsì˜ ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ìœ¼ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.

**Windows zip íŒŒì¼ ë‹¤ìš´ë¡œë“œ â†’ ì••ì¶• í’€ê¸° â†’ `bin` í´ë”ë¡œ ì´ë™ â†’ `elasticsearch.bat` ì‹¤í–‰**

ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ http://localhost:9200/ ì—ì„œ í´ëŸ¬ìŠ¤í„° ì´ë¦„ê³¼ ë²„ì „ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## 02. Elasticsearch ê¸°ë³¸ ê°œë…
### Elastic ì €ì¥ êµ¬ì¡°
|7.0 ë²„ì „ ì´ì „|7.0 ë²„ì „ ì´í›„|
|---|---|
|![](../.vuepress/public/images/analyze-data-with-elk-stack/01-01.png)|![](../.vuepress/public/images/analyze-data-with-elk-stack/01-02.png)|

### RDBì™€ ì €ì¥ êµ¬ì¡° ë¹„êµ
|Elasticsearch|RDB|
|:---|:---|
|Index|Database|
|Type (7.0ë²„ì „ë¶€í„° ì‚¬ë¼ì§„ ê°œë…)|Table|
|Document|Row|
|Field|Column|
|Mapping|Schema|

### RDBì™€ ì¿¼ë¦¬ ë¹„êµ
|CRUD|Elasticsearch|RDB|
|:---|:---|:---|
|Read|GET|Select|
|Create|PUT|Insert|
|Update|POST|Update|
|Delete|DELETE|Delete|

## 03. Elasticsearch ë°ì´í„° ì…ë ¥, ì¡°íšŒ, ì‚­ì œ (GET, POST, PUT, DELETE)
### Index ìƒì„±í•˜ê¸°
Indexë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” `PUT` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤. ì—¬ê¸°ì„œ `index name`ì€ ìƒì„±í•˜ë ¤ëŠ” index ì´ë¦„ì´ë‹¤.
```shell
curl -X PUT {elasticsearch address}/{index name}
# e.g.
curl -X PUT http://localhost:9200/classes
```
ìƒì„±ì´ ì™„ë£Œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ ë¬¸êµ¬ê°€ ì¶œë ¥ëœë‹¤.
```shell
{"acknowledged":true,"shards_acknowledged":true,"index":"classes"}
```

### Index ì¡°íšŒí•˜ê¸°
Indexë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ì„œëŠ” `GET` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤. ì—¬ê¸°ì„œ `index name`ì€ ì¡°íšŒí•˜ë ¤ëŠ” index ì´ë¦„ì´ë‹¤.
```shell
curl -X GET {elasticsearch address}/{index name}
# e.g.
curl -X GET http://localhost:9200/classes
```

ê²°ê³¼ê°’ì„ JSON í˜•ì‹ì— ë§ì¶°ì„œ ë³´ê³  ì‹¶ë‹¤ë©´ ëì— `?pretty`ë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.
```shell
curl -X GET http://localhost:9200/classes?pretty
```

### Index ì‚­ì œí•˜ê¸°
Indexë¥¼ ì‚­ì œí•˜ê¸° ìœ„í•´ì„œëŠ” `DELETE` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤. ì—¬ê¸°ì„œ `index name`ì€ ì‚­ì œí•˜ë ¤ëŠ” index ì´ë¦„ì´ë‹¤.
```shell
curl -X DELETE {elasticsearch address}/{index name}
# e.g.
curl -X DELETE http://localhost:9200/classes
```
ì‚­ì œê°€ ì™„ë£Œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ ë¬¸êµ¬ê°€ ì¶œë ¥ëœë‹¤.
```shell
{"acknowledged":true}
```
### Document URL ë³€í™”
ê¸€ ì´ˆë°˜ ì €ì¥ êµ¬ì¡°ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ 7.0 ë²„ì „ë¶€í„°ëŠ” Document Typeì— ëŒ€í•œ ê°œë…ì´ ì‚¬ë¼ì¡Œìœ¼ë©°, ElasticsearchëŠ” ë‹¨ì¼ ë„íë¨¼íŠ¸ë³„ë¡œ ê³ ìœ í•œ URLì„ ê°–ëŠ”ë‹¤. ë„íë¨¼íŠ¸ì— ì ‘ê·¼í•˜ëŠ” URLì€ ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆë‹¤.
```
{elasticsearch address}/{index name}/_doc/{document id}
```
ì°¸ê³ ë¡œ, 6.x ë²„ì „ê¹Œì§€ëŠ” Document Typeì´ë¼ëŠ” ê°œë…ì´ ì¡´ì¬í–ˆê¸°ì— URL êµ¬ì¡°ê°€ ë‹¬ëìœ¼ë©°, ê°•ì˜ëŠ” 5.1.1 ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤. 6.x ë²„ì „ê¹Œì§€ URL êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ì•˜ë‹¤.
```
{elasticsearch address}/{index name}/{document type}/{document id}
```

### Document ìƒì„±í•˜ê¸°
ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ documentë¥¼ ìƒì„±í•´ë³´ì. ì—¬ê¸°ì„œë¶€í„° `?pretty`ë¥¼ ë¶™ì—¬ ëª…ë ¹ì–´ì„ ì‹¤í–‰í•  ì˜ˆì •ì´ê¸°ì—, ì˜ˆì œ URLì— `?pretty`ê°€ ë¶™ì–´ìˆë‹¤.

ì°¸ê³ ë¡œ, -Hë¥¼ í†µí•´ Header ê°’ì„ ì£¼ì§€ ì•Šìœ¼ë©´ **406 ì—ëŸ¬**ê°€ ë°œìƒí•˜ë‹ˆ ë°˜ë“œì‹œ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

```shell
curl -X PUT {elasticsearch address}/{index name}/_doc/{document id} -H'Content-Type:application/json' -d '{{body ë‚´ìš©}}'
# e.g.
curl -X PUT http://localhost:9200/classes/_doc/1?pretty -H'Content-Type:application/json' -d '{"file":"Algorithm","professor":"John"}'
```
ìƒì„±ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 1,
  "result" : "created",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 0,
  "_primary_term" : 1
}
```

ë§¤ë²ˆ URLì— ì§ì ‘ bodyë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒì€ êµ‰ì¥íˆ ë²ˆê±°ë¡­ê³  ì‹¤ìˆ˜ë¥¼ í•˜ê¸° ì‰½ë‹¤. ë‹¤í–‰íˆë„ json íŒŒì¼ì„ í†µí•´ documentë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```shell
curl -X PUT {elasticsearch address}/{index name}/_doc/{document id} -H'Content-Type:application/json' -d @{íŒŒì¼ëª…}.json
#e.g.
curl -X PUT http://localhost:9200/classes/_doc/2?pretty -H'Content-Type:application/json' -d @oneclass.json
```
íŒŒì¼ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
```json
{
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
}
```

ì‹¤ìˆ˜ë¡œ documentê°€ ë®ì–´ì”Œì›Œì§€ëŠ” ê²ƒì„ ë§‰ê³  ì‹¶ë‹¤ë©´ `_doc` ëŒ€ì‹  `_create`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. `_create`ëŠ” **ìƒˆë¡œìš´ document ìƒì„±ë§Œì„ í—ˆìš©**í•œë‹¤.
```shell
curl -X PUT {elasticsearch address}/{index name}/_create/{document id} -H'Content-Type:application/json' -d '{{body ë‚´ìš©}}'
```
ì°¸ê³ ë¡œ, PUTì´ ì•„ë‹Œ POSTë¥¼ í†µí•´ì„œë„ documentë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. POSTë¥¼ í†µí•´ ìƒì„±í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ document idë¥¼ ê¸°ì…í•˜ì§€ ì•Šìœ¼ë©°, idëŠ” ëœë¤í•œ ê°’ìœ¼ë¡œ ìƒì„±ëœë‹¤.
```shell
curl -X POST {elasticsearch address}/{index name}/_doc -H'Content-Type:application/json' -d '{body ë‚´ìš©}'
```

### Document ì¡°íšŒí•˜ê¸°
Document ì¡°íšŒ ëª…ë ¹ì€ Indexì™€ ìœ ì‚¬í•˜ë‹¤.
```shell
curl -X GET {elasticsearch address}/{index name}/_doc/{document id}
# e.g.
curl -X GET http://localhost:9200/classes/_doc/1?pretty
```
ìœ„ì—ì„œ ìƒì„±í–ˆë˜ document id 1ê³¼ 2ì˜ ë‚´ìš©ì„ ì¡°íšŒí•´ë³´ì!
```json
// document id 1 ì¡°íšŒ ê²°ê³¼
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 1,
  "_seq_no" : 0,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "file" : "Algorithm",
    "professor" : "John"
  }
}
// document id 2 ì¡°íšŒ ê²°ê³¼
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "2",
  "_version" : 1,
  "_seq_no" : 1,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
  }
}
```

### Document ìˆ˜ì •í•˜ê¸°
Indexë¥¼ ìˆ˜ì •í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê°€ì§€ì´ë‹¤.
1. PUTì„ ì‚¬ìš©í•œ ëª¨ë“  ë‚´ìš© ë®ì–´ì“°ê¸°
2. POSTë¥¼ ì‚¬ìš©í•´ ì›í•˜ëŠ” í•„ë“œ ë‚´ìš© ë³€ê²½í•˜ê¸°

ë¨¼ì €, ì²«ë²ˆì§¸ ë°©ë²•ì„ ì‚¬ìš©í•´ ì´ì „ì— ìƒì„±í•œ `oneclass.json` ë‚´ìš©ìœ¼ë¡œ document id 1ë²ˆì˜ ë‚´ìš©ì„ ë®ì–´ì¨ë³´ì.
```shell
curl -X PUT http://localhost:9200/classes/_doc/1?pretty -H'Content-Type:application/json' -d @oneclass.json
```
`GET`ì„ í†µí•´ ë‚´ìš©ì„ í™•ì¸í•´ë³´ë©´ `oneclass.json` íŒŒì¼ ë‚´ìš©ìœ¼ë¡œ ë®ì–´ì”Œì›Œì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, `_version` ì´ 1ì—ì„œ 2ë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 2,
  "_seq_no" : 2,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
  }
}
```

ì´ë²ˆì—ëŠ” `POST`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ë ¤ê³  í•œë‹¤. ì´ ë°©ë²•ì€ `_doc`ì´ ì•„ë‹Œ `_update`ë¥¼ ì‚¬ìš©í•˜ë©°, ì›í•˜ëŠ” íŠ¹ì • í•„ë“œë§Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. document id 1ë²ˆì˜ ë‚´ìš© ì¤‘ professorë¥¼ Johnìœ¼ë¡œ ë³€ê²½í•´ë³´ì.
```shell
curl -X POST {elasticsearch address}/{index name}/_update/{document id} -H'Content-Type:application/json' -d '{"doc": {ì—…ë°ì´íŠ¸í•  ë‚´ìš©}}'
# e.g.
curl -X POST http://localhost:9200/classes/_update/1?pretty -H'Content-Type:application/json' -d '{"doc":{"Professor":"John"}}'
```
`GET`ì„ í†µí•´ í™•ì¸í•´ë³´ë©´ professorê°€ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 3,
  "_seq_no" : 3,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "John",
    "major" : "Computer Science"
  }
}
```

### Document ì‚­ì œí•˜ê¸°
Documentë¥¼ ì‚­ì œí•˜ëŠ” ë°©ë²•ì€ Indexë¥¼ ì‚­ì œí•˜ëŠ” ë°©ë²•ê³¼ ìœ ì‚¬í•˜ë‹¤.
```shell
curl -X DELETE {elasticsearch address}/{index name}/_doc/{document id}
# e.g.
curl -X DELETE http://localhost:9200/classes/_doc/1?pretty
```
ì˜ˆì œë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ, document id 1ë²ˆì¸ Documentê°€ ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ë©´ ì•„ë˜ê³¼ ê°™ì€ ë¬¸êµ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 4,
  "result" : "deleted",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 4,
  "_primary_term" : 1
}

```

> ë³¸ ê²Œì‹œê¸€ì€ [ELK ìŠ¤íƒ (ElasticSearch, Logstash, Kibana) ìœ¼ë¡œ ë°ì´í„° ë¶„ì„](https://www.inflearn.com/course/elk-%EC%8A%A4%ED%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D/dashboard) ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
>
>
> ìƒì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ê°•ì˜ ìˆ˜ê°•ì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.
>

- ì¶”ê°€ë¡œ ì°¸ê³  ë§í¬
  - https://noransaja.tistory.com/10
  - https://velog.io/@broccoliindb/elasticsearch-index-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%EC%88%98%EC%A0%95-%EB%85%B8%EB%A6%AC-%ED%86%A0%ED%81%B0-%EC%84%A4%EC%A0%95
  - https://esbook.kimjmin.net/04-data/4.2-crud