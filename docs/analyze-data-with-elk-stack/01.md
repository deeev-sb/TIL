# 01. Elasticsearch ÏÑ§Ïπò Î∞è CRUD

## 01. Elasticsearch ÏÑ§Ïπò
ElasticsearchÎäî ÏïÑÎûò ÎßÅÌÅ¨ÏóêÏÑú Îã§Ïö¥Î°úÎìú Î∞õÏïÑ ÏÑ§ÏπòÌïòÎ©¥ ÎêúÎã§.

üëâ [Elasticsearch ÏÑ§Ïπò ÎßÅÌÅ¨](https://www.elastic.co/kr/downloads/elasticsearch)

ÌòÑ ÏãúÏ†ê (2023.03.22) ÏµúÏã† Î≤ÑÏ†ÑÏùÄ `8.6.2`Ïù¥Î©∞, Apache License 2.0Ïùò Ïò§ÌîàÏÜåÏä§Î•º Ïù¥Ïö©ÌïòÍ∏∏ Î∞îÎùºÎ©¥ `7.10.2` Î≤ÑÏ†ÑÏùÑ ÏÑ§ÏπòÌïòÍ∏∏ Î∞îÎûÄÎã§. Ï∞∏Í≥†Î°ú, 7.11 Î≤ÑÏ†ÑÎ∂ÄÌÑ∞Îäî ÎùºÏù¥ÏÑºÏä§Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÎã§.

Ï∞∏Í≥†Î°ú, 7.x Î≤ÑÏ†ÑÎ∂ÄÌÑ∞Îäî ÏûêÎ∞î Í∞ÄÏÉÅ Î®∏Ïã†Ïù¥ ÏóòÎùºÏä§Ìã±ÏÑúÏπò ÎÇ¥Ïóê ÎÇ¥Ïû•ÎêòÏñ¥ ÏûàÏñ¥ÏÑú Î≥ÑÎèÑÎ°ú ÏÑ§ÏπòÌï† ÌïÑÏöîÍ∞Ä ÏóÜÏúºÎÇò, Î°úÍ∑∏Ïä§ÌÉúÏãúÎ•º Ïù¥Ïö©ÌïòÎ†§Îäî Í≤ΩÏö∞ ÏûêÎ∞î Í∞ÄÏÉÅ Î®∏Ïã†Ïù¥ ÌïÑÏöîÌïòÎã§. ÏßÄÏõê Î≤ÑÏ†ÑÏóê ÎåÄÌïú ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Îäî ÏïÑÎûò ÎßÅÌÅ¨Î•º ÌÜµÌï¥ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.

üëâ [ÏßÄÏõê Î≤ÑÏ†Ñ ÌôïÏù∏ÌïòÎü¨ Í∞ÄÍ∏∞](https://www.elastic.co/kr/support/matrix#matrix_compatibility)

### Windows ÌôòÍ≤ΩÏóê Elasticsearch ÏÑ§ÏπòÌïòÍ∏∞

WindowsÏùò Í≤ΩÏö∞Îäî Îã§ÏùåÍ≥º Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏÑ§ÏπòÌï† Ïàò ÏûàÎã§.

**Windows zip ÌååÏùº Îã§Ïö¥Î°úÎìú ‚Üí ÏïïÏ∂ï ÌíÄÍ∏∞ ‚Üí `bin` Ìè¥ÎçîÎ°ú Ïù¥Îèô ‚Üí `elasticsearch.bat` Ïã§Ìñâ**

ÏÑ§ÏπòÍ∞Ä ÏôÑÎ£åÎêòÎ©¥ http://localhost:9200/ ÏóêÏÑú ÌÅ¥Îü¨Ïä§ÌÑ∞ Ïù¥Î¶ÑÍ≥º Î≤ÑÏ†Ñ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.

## 02. Elasticsearch Í∏∞Î≥∏ Í∞úÎÖê
### Elastic Ï†ÄÏû• Íµ¨Ï°∞
|7.0 Î≤ÑÏ†Ñ Ïù¥Ï†Ñ|7.0 Î≤ÑÏ†Ñ Ïù¥ÌõÑ|
|---|---|
|![](../.vuepress/public/images/analyze-data-with-elk-stack/01-01.png)|![](../.vuepress/public/images/analyze-data-with-elk-stack/01-02.png)|

### RDBÏôÄ Ï†ÄÏû• Íµ¨Ï°∞ ÎπÑÍµê
|Elasticsearch|RDB|
|:---|:---|
|Index|Database|
|Type (7.0Î≤ÑÏ†ÑÎ∂ÄÌÑ∞ ÏÇ¨ÎùºÏßÑ Í∞úÎÖê)|Table|
|Document|Row|
|Field|Column|
|Mapping|Schema|

### RDBÏôÄ ÏøºÎ¶¨ ÎπÑÍµê
|CRUD|Elasticsearch|RDB|
|:---|:---|:---|
|Read|GET|Select|
|Create|PUT|Insert|
|Update|POST|Update|
|Delete|DELETE|Delete|

## 03. Elasticsearch Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•, Ï°∞Ìöå, ÏÇ≠Ï†ú (GET, POST, PUT, DELETE)
### Index ÏÉùÏÑ±ÌïòÍ∏∞
IndexÎ•º ÏÉùÏÑ±ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî `PUT` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï¥ÏÑú ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú Î™ÖÎ†πÏñ¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÎêúÎã§. Ïó¨Í∏∞ÏÑú `index name`ÏùÄ ÏÉùÏÑ±ÌïòÎ†§Îäî index Ïù¥Î¶ÑÏù¥Îã§.
```shell
curl -X PUT {elasticsearch address}/{index name}
# e.g.
curl -X PUT http://localhost:9200/classes
```
ÏÉùÏÑ±Ïù¥ ÏôÑÎ£åÎêòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Î¨∏Íµ¨Í∞Ä Ï∂úÎ†•ÎêúÎã§.
```shell
{"acknowledged":true,"shards_acknowledged":true,"index":"classes"}
```

### Index Ï°∞ÌöåÌïòÍ∏∞
IndexÎ•º Ï°∞ÌöåÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî `GET` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï¥ÏÑú ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú Î™ÖÎ†πÏñ¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÎêúÎã§. Ïó¨Í∏∞ÏÑú `index name`ÏùÄ Ï°∞ÌöåÌïòÎ†§Îäî index Ïù¥Î¶ÑÏù¥Îã§.
```shell
curl -X GET {elasticsearch address}/{index name}
# e.g.
curl -X GET http://localhost:9200/classes
```

Í≤∞Í≥ºÍ∞íÏùÑ JSON ÌòïÏãùÏóê ÎßûÏ∂∞ÏÑú Î≥¥Í≥† Ïã∂Îã§Î©¥ ÎÅùÏóê `?pretty`Î•º Ï∂îÍ∞ÄÌïòÎ©¥ ÎêúÎã§.
```shell
curl -X GET http://localhost:9200/classes?pretty
```

### Index ÏÇ≠Ï†úÌïòÍ∏∞
IndexÎ•º ÏÇ≠Ï†úÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî `DELETE` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï¥ÏÑú ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú Î™ÖÎ†πÏñ¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÎêúÎã§. Ïó¨Í∏∞ÏÑú `index name`ÏùÄ ÏÇ≠Ï†úÌïòÎ†§Îäî index Ïù¥Î¶ÑÏù¥Îã§.
```shell
curl -X DELETE {elasticsearch address}/{index name}
# e.g.
curl -X DELETE http://localhost:9200/classes
```
ÏÇ≠Ï†úÍ∞Ä ÏôÑÎ£åÎêòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Î¨∏Íµ¨Í∞Ä Ï∂úÎ†•ÎêúÎã§.
```shell
{"acknowledged":true}
```
### Document URL Î≥ÄÌôî
Í∏Ä Ï¥àÎ∞ò Ï†ÄÏû• Íµ¨Ï°∞ÏóêÏÑú Î≥º Ïàò ÏûàÎìØ 7.0 Î≤ÑÏ†ÑÎ∂ÄÌÑ∞Îäî Document TypeÏóê ÎåÄÌïú Í∞úÎÖêÏù¥ ÏÇ¨ÎùºÏ°åÏúºÎ©∞, ElasticsearchÎäî Îã®Ïùº ÎèÑÌÅêÎ®ºÌä∏Î≥ÑÎ°ú Í≥†Ïú†Ìïú URLÏùÑ Í∞ñÎäîÎã§. ÎèÑÌÅêÎ®ºÌä∏Ïóê Ï†ëÍ∑ºÌïòÎäî URLÏùÄ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Íµ¨Ï°∞Î°ú ÎêòÏñ¥ ÏûàÎã§.
```
{elasticsearch address}/{index name}/_doc/{document id}
```
Ï∞∏Í≥†Î°ú, 6.x Î≤ÑÏ†ÑÍπåÏßÄÎäî Document TypeÏù¥ÎùºÎäî Í∞úÎÖêÏù¥ Ï°¥Ïû¨ÌñàÍ∏∞Ïóê URL Íµ¨Ï°∞Í∞Ä Îã¨ÎûêÏúºÎ©∞, Í∞ïÏùòÎäî 5.1.1 Î≤ÑÏ†ÑÏùÑ ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÎã§. 6.x Î≤ÑÏ†ÑÍπåÏßÄ URL Íµ¨Ï°∞Îäî ÏïÑÎûòÏôÄ Í∞ôÏïòÎã§.
```
{elasticsearch address}/{index name}/{document type}/{document id}
```

### Document ÏÉùÏÑ±ÌïòÍ∏∞
ÏïÑÎûò Î™ÖÎ†πÏñ¥Î•º Ïù¥Ïö©Ìï¥ documentÎ•º ÏÉùÏÑ±Ìï¥Î≥¥Ïûê. Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ `?pretty`Î•º Î∂ôÏó¨ Î™ÖÎ†πÏñ¥ÏùÑ Ïã§ÌñâÌï† ÏòàÏ†ïÏù¥Í∏∞Ïóê, ÏòàÏ†ú URLÏóê `?pretty`Í∞Ä Î∂ôÏñ¥ÏûàÎã§.

Ï∞∏Í≥†Î°ú, -HÎ•º ÌÜµÌï¥ Header Í∞íÏùÑ Ï£ºÏßÄ ÏïäÏúºÎ©¥ **406 ÏóêÎü¨**Í∞Ä Î∞úÏÉùÌïòÎãà Î∞òÎìúÏãú ÎÑ£Ïñ¥Ï£ºÏñ¥Ïïº ÌïúÎã§.

```shell
curl -X PUT {elasticsearch address}/{index name}/_doc/{document id} -H'Content-Type:application/json' -d '{{body ÎÇ¥Ïö©}}'
# e.g.
curl -X PUT http://localhost:9200/classes/_doc/1?pretty -H'Content-Type:application/json' -d '{"file":"Algorithm","professor":"John"}'
```
ÏÉùÏÑ±Ïù¥ ÏôÑÎ£åÎêòÎ©¥ Îã§ÏùåÍ≥º Í∞ôÏùÄ Í≤∞Í≥ºÎ•º Î≥º Ïàò ÏûàÎã§.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 1,
  "result" : "created",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 0,
  "_primary_term" : 1
}
```

Îß§Î≤à URLÏóê ÏßÅÏ†ë bodyÎ•º ÏûÖÎ†•ÌïòÎäî Í≤ÉÏùÄ ÍµâÏû•Ìûà Î≤àÍ±∞Î°≠Í≥† Ïã§ÏàòÎ•º ÌïòÍ∏∞ ÏâΩÎã§. Îã§ÌñâÌûàÎèÑ json ÌååÏùºÏùÑ ÌÜµÌï¥ documentÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏúºÎ©∞, ÏïÑÎûòÏôÄ Í∞ôÏùÄ Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©ÌïòÎ©¥ ÎêúÎã§.
```shell
curl -X PUT {elasticsearch address}/{index name}/_doc/{document id} -H'Content-Type:application/json' -d @{ÌååÏùºÎ™Ö}.json
#e.g.
curl -X PUT http://localhost:9200/classes/_doc/2?pretty -H'Content-Type:application/json' -d @oneclass.json
```
ÌååÏùºÏùò ÎÇ¥Ïö©ÏùÄ Îã§ÏùåÍ≥º Í∞ôÎã§.
```json
{
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
}
```

Ïã§ÏàòÎ°ú documentÍ∞Ä ÎçÆÏñ¥ÏîåÏõåÏßÄÎäî Í≤ÉÏùÑ ÎßâÍ≥† Ïã∂Îã§Î©¥ `_doc` ÎåÄÏã† `_create`Î•º ÏÇ¨Ïö©ÌïòÎ©¥ ÎêúÎã§. `_create`Îäî **ÏÉàÎ°úÏö¥ document ÏÉùÏÑ±ÎßåÏùÑ ÌóàÏö©**ÌïúÎã§.
```shell
curl -X PUT {elasticsearch address}/{index name}/_create/{document id} -H'Content-Type:application/json' -d '{{body ÎÇ¥Ïö©}}'
```
Ï∞∏Í≥†Î°ú, PUTÏù¥ ÏïÑÎãå POSTÎ•º ÌÜµÌï¥ÏÑúÎèÑ documentÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÎã§. POSTÎ•º ÌÜµÌï¥ ÏÉùÏÑ±Ìï† ÎïåÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ document idÎ•º Í∏∞ÏûÖÌïòÏßÄ ÏïäÏúºÎ©∞, idÎäî ÎûúÎç§Ìïú Í∞íÏúºÎ°ú ÏÉùÏÑ±ÎêúÎã§.
```shell
curl -X POST {elasticsearch address}/{index name}/_doc -H'Content-Type:application/json' -d '{body ÎÇ¥Ïö©}'
```

### Document Ï°∞ÌöåÌïòÍ∏∞
Document Ï°∞Ìöå Î™ÖÎ†πÏùÄ IndexÏôÄ Ïú†ÏÇ¨ÌïòÎã§.
```shell
curl -X GET {elasticsearch address}/{index name}/_doc/{document id}
# e.g.
curl -X GET http://localhost:9200/classes/_doc/1?pretty
```
ÏúÑÏóêÏÑú ÏÉùÏÑ±ÌñàÎçò document id 1Í≥º 2Ïùò ÎÇ¥Ïö©ÏùÑ Ï°∞ÌöåÌï¥Î≥¥Ïûê!
```json
// document id 1 Ï°∞Ìöå Í≤∞Í≥º
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 1,
  "_seq_no" : 0,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "file" : "Algorithm",
    "professor" : "John"
  }
}
// document id 2 Ï°∞Ìöå Í≤∞Í≥º
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "2",
  "_version" : 1,
  "_seq_no" : 1,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
  }
}
```

### Document ÏàòÏ†ïÌïòÍ∏∞
IndexÎ•º ÏàòÏ†ïÌïòÎäî Î∞©Î≤ïÏùÄ Îã§ÏùåÍ≥º Í∞ôÏù¥ Îëê Í∞ÄÏßÄÏù¥Îã§.
1. PUTÏùÑ ÏÇ¨Ïö©Ìïú Î™®Îì† ÎÇ¥Ïö© ÎçÆÏñ¥Ïì∞Í∏∞
2. POSTÎ•º ÏÇ¨Ïö©Ìï¥ ÏõêÌïòÎäî ÌïÑÎìú ÎÇ¥Ïö© Î≥ÄÍ≤ΩÌïòÍ∏∞

Î®ºÏ†Ä, Ï≤´Î≤àÏß∏ Î∞©Î≤ïÏùÑ ÏÇ¨Ïö©Ìï¥ Ïù¥Ï†ÑÏóê ÏÉùÏÑ±Ìïú `oneclass.json` ÎÇ¥Ïö©ÏúºÎ°ú document id 1Î≤àÏùò ÎÇ¥Ïö©ÏùÑ ÎçÆÏñ¥Ïç®Î≥¥Ïûê.
```shell
curl -X PUT http://localhost:9200/classes/_doc/1?pretty -H'Content-Type:application/json' -d @oneclass.json
```
`GET`ÏùÑ ÌÜµÌï¥ ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏Ìï¥Î≥¥Î©¥ `oneclass.json` ÌååÏùº ÎÇ¥Ïö©ÏúºÎ°ú ÎçÆÏñ¥ÏîåÏõåÏßÑ Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏúºÎ©∞, `_version` Ïù¥ 1ÏóêÏÑú 2Î°ú Î≥ÄÍ≤ΩÎêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 2,
  "_seq_no" : 2,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "Herry",
    "major" : "Computer Science"
  }
}
```

Ïù¥Î≤àÏóêÎäî `POST`Î•º ÏÇ¨Ïö©ÌïòÎäî Î∞©Î≤ïÏóê ÎåÄÌï¥ ÏïåÏïÑÎ≥¥Î†§Í≥† ÌïúÎã§. Ïù¥ Î∞©Î≤ïÏùÄ `_doc`Ïù¥ ÏïÑÎãå `_update`Î•º ÏÇ¨Ïö©ÌïòÎ©∞, ÏõêÌïòÎäî ÌäπÏ†ï ÌïÑÎìúÎßå Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÎã§. document id 1Î≤àÏùò ÎÇ¥Ïö© Ï§ë professorÎ•º JohnÏúºÎ°ú Î≥ÄÍ≤ΩÌï¥Î≥¥Ïûê.
```shell
curl -X POST {elasticsearch address}/{index name}/_update/{document id} -H'Content-Type:application/json' -d '{"doc": {ÏóÖÎç∞Ïù¥Ìä∏Ìï† ÎÇ¥Ïö©}}'
# e.g.
curl -X POST http://localhost:9200/classes/_update/1?pretty -H'Content-Type:application/json' -d '{"doc":{"Professor":"John"}}'
```
`GET`ÏùÑ ÌÜµÌï¥ ÌôïÏù∏Ìï¥Î≥¥Î©¥ professorÍ∞Ä Î≥ÄÍ≤ΩÎêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 3,
  "_seq_no" : 3,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "John",
    "major" : "Computer Science"
  }
}
```

### Document ÏÇ≠Ï†úÌïòÍ∏∞
DocumentÎ•º ÏÇ≠Ï†úÌïòÎäî Î∞©Î≤ïÏùÄ IndexÎ•º ÏÇ≠Ï†úÌïòÎäî Î∞©Î≤ïÍ≥º Ïú†ÏÇ¨ÌïòÎã§.
```shell
curl -X DELETE {elasticsearch address}/{index name}/_doc/{document id}
# e.g.
curl -X DELETE http://localhost:9200/classes/_doc/1?pretty
```
ÏòàÏ†úÎ•º Ïã§ÌñâÌñàÏùÑ Îïå, document id 1Î≤àÏù∏ DocumentÍ∞Ä Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÎ©¥ ÏïÑÎûòÍ≥º Í∞ôÏùÄ Î¨∏Íµ¨Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
```json
{
  "_index" : "classes",
  "_type" : "_doc",
  "_id" : "1",
  "_version" : 4,
  "result" : "deleted",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 4,
  "_primary_term" : 1
}

```

> Î≥∏ Í≤åÏãúÍ∏ÄÏùÄ [ELK Ïä§ÌÉù (ElasticSearch, Logstash, Kibana) ÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù](https://www.inflearn.com/course/elk-%EC%8A%A4%ED%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D/dashboard) Í∞ïÏùòÎ•º Ï∞∏Í≥†ÌïòÏó¨ ÏûëÏÑ±ÎêòÏóàÏäµÎãàÎã§.
>
>
> ÏÉÅÏÑ∏Ìïú ÎÇ¥Ïö©Ïù¥ Í∂ÅÍ∏àÌïòÏãúÎã§Î©¥ Í∞ïÏùò ÏàòÍ∞ïÏùÑ Ï∂îÏ≤úÌï¥ ÎìúÎ¶ΩÎãàÎã§.
>

- Ï∂îÍ∞ÄÎ°ú Ï∞∏Í≥† ÎßÅÌÅ¨
  - [https://noransaja.tistory.com/10](https://noransaja.tistory.com/10)
  - [https://velog.io/@broccoliindb/elasticsearch-index-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%EC%88%98%EC%A0%95-%EB%85%B8%EB%A6%AC-%ED%86%A0%ED%81%B0-%EC%84%A4%EC%A0%95](https://velog.io/@broccoliindb/elasticsearch-index-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%EC%88%98%EC%A0%95-%EB%85%B8%EB%A6%AC-%ED%86%A0%ED%81%B0-%EC%84%A4%EC%A0%95)
  - [https://esbook.kimjmin.net/04-data/4.2-crud](https://esbook.kimjmin.net/04-data/4.2-crud)