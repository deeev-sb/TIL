2023-07-18 13:30:02.273 1 DEBUG [RoutePredicateHandlerMapping.java:lambda$lookupRoute$7():146] Route matched: get
2023-07-18 13:30:02.275 1 DEBUG [RoutePredicateHandlerMapping.java:lambda$getHandlerInternal$0():93] Mapping [Exchange: GET http://[0:0:0:0:0:0:0:1%0]:8080/api/get?key=api-key] to Route{id='get', uri=http://127.0.0.1:80, order=0, predicate=(Paths: [/api/get], match trailing slash: true && Methods: [OPTIONS, GET]), gatewayFilters=[[com.test.api.filters.factory.RequestLimiterGatewayFilterFactory$$Lambda$1236/0x00000008014042f8@c2dff4c, order = 1], [[RewritePath /api/get = '/get'], order = 1], [[RemoveRequestParameters name = 'key'], order = 2], [[RemoveRequestParameters name = 'limited'], order = 3], [[RemoveRequestParameters name = 'beginIndex'], order = 4], [[DedupeResponseHeader Access-Control-Allow-Origin Access-Control-Allow-Credentials = RETAIN_FIRST], order = 5]], metadata={}
2023-07-18 13:30:02.275 1 DEBUG [AbstractHandlerMapping.java:lambda$getHandler$1():189] [request-id-1] Mapped t2023-07-18o org.springframework.cloud.gateway.handler.FilteringWebHandler@4d3e62db
2023-07-18 13:30:02.275 1 DEBUG [FilteringWebHandler.java:handle():85] Sorted gatewayFilterFactories: [[GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.RemoveCachedBodyFilter@2503ec73}, order = -2147483648], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@20f6f88c}, order = -2147482648], [GatewayFilterAdapter{delegate=com.test.api.filters.AuthorizationFilter@53a7a60c}, order = -4], [GatewayFilterAdapter{delegate=com.test.api.filters.DefaultGlobalFilter@28bdbe88}, order = -3], [GatewayFilterAdapter{delegate=com.test.api.filters.OptionFilter@6a87026}, order = -2], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@600f5704}, order = -1], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.ForwardPathFilter@44b21f9f}, order = 0], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.GatewayMetricsFilter@6296474f}, order = 0], [com.test.api.filters.factory.RequestLimiterGatewayFilterFactory$$Lambda$1236/0x00000008014042f8@c2dff4c, order = 1], [[RewritePath /api/get = '/get'], order = 1], [[RemoveRequestParameters name = 'key'], order = 2], [[RemoveRequestParameters name = 'limited'], order = 3], [[RemoveRequestParameters name = 'beginIndex'], order = 4], [[DedupeResponseHeader Access-Control-Allow-Origin Access-Control-Allow-Credentials = RETAIN_FIRST], order = 5], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@606f81b5}, order = 10000], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.config.GatewayNoLoadBalancerClientAutoConfiguration$NoLoadBalancerClientFilter@4288d98e}, order = 10150], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ee8130e}, order = 2147483646], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@ef60710}, order = 2147483647], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@5e1fc42f}, order = 2147483647]]
2023-07-18 13:30:02.283 1 INFO  [DefaultGlobalFilter.java:filter():46] GlobalFilter Start >>> request_id=[request-id-1]
2023-07-18 13:30:02.283 1 DEBUG [DefaultGlobalFilter.java:lambda$filter$3():68] status=[REQUEST] key=[api-key] request_id=[request-id-1] host=[api.test.com] client_ip=[123.456.789.11] method=[GET] user_agent=[Mozilla/5.0 (Linux; Android 13; SM-S908N Build/TP1A.220624.014; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/104.0.5112.97 Mobile Safari/537.36Morpheus/NT] accept=[*/*] content_type=[*/*] service=[API_GET] url=[/api/get] http_status=[100] data=[{"key":"api-key"}]
2023-07-18 13:30:02.284 1 DEBUG [RedisRequestLimiter.java:lambda$isAllowed$2():52] allowed: true, tokensLeft: -1
2023-07-18 13:30:02.285 1 DEBUG [ObservedRequestHttpHeadersFilter.java:filter():64] Will instrument the HTTP request headers [host:"api.test.com", pragma:"no-cache", cache-control:"no-cache", user-agent:"Mozilla/5.0 (Linux; Android 13; SM-S908N Build/TP1A.220624.014; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/104.0.5112.97 Mobile Safari/537.36Morpheus/NT", accept:"*/*", x-requested-with:"com.kia.red", sec-fetch-site:"cross-site", sec-fetch-mode:"no-cors", sec-fetch-dest:"script", accept-encoding:"gzip, deflate", accept-language:"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7", cookie:"cookie", x-request-id:"request-id-1", Forwarded:"proto=null;host=api.test.com;for="[0:0:0:0:0:0:0:1%0]:49950"", X-Forwarded-For:"123.456.789.11, 123.456.789.11,0:0:0:0:0:0:0:1%0", X-Forwarded-Prefix:"/api", X-Forwarded-Port:"80"]
2023-07-18 13:30:02.285 1 DEBUG [ObservedRequestHttpHeadersFilter.java:filter():76] Client observation  {name=http.client.requests(null), error=null, context=name='http.client.requests', contextualName='null', error='null', lowCardinalityKeyValues=[http.method='GET', http.status_code='UNKNOWN', spring.cloud.gateway.route.id='get', spring.cloud.gateway.route.uri='http://127.0.0.1:80'], highCardinalityKeyValues=[http.uri='/get'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@6a7a7d49', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=2.2341E-5, duration(nanos)=22341.0, startTimeNanos=13196234625658183}'], parentObservation={name=http.server.requests(null), error=null, context=name='http.server.requests', contextualName='null', error='null', lowCardinalityKeyValues=[exception='none', method='GET', outcome='SUCCESS', status='200', uri='UNKNOWN'], highCardinalityKeyValues=[http.url='/api/get'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@3a8a910f', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.012362195, duration(nanos)=1.2362195E7, startTimeNanos=13196234613339659}'], parentObservation=null}} created for the request. New headers are [host:"api.test.com", pragma:"no-cache", cache-control:"no-cache", user-agent:"Mozilla/5.0 (Linux; Android 13; SM-S908N Build/TP1A.220624.014; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/104.0.5112.97 Mobile Safari/537.36Morpheus/NT", accept:"*/*", x-requested-with:"com.kia.red", sec-fetch-site:"cross-site", sec-fetch-mode:"no-cors", sec-fetch-dest:"script", accept-encoding:"gzip, deflate", accept-language:"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7", cookie:"cookie", x-request-id:"request-id-1", Forwarded:"proto=null;host=api.test.com;for="[0:0:0:0:0:0:0:1%0]:49950"", X-Forwarded-For:"123.456.789.11, 123.456.789.11,0:0:0:0:0:0:0:1%0", X-Forwarded-Prefix:"/api", X-Forwarded-Port:"80"]
2023-07-18 13:30:02.296 1 DEBUG [ObservedResponseHttpHeadersFilter.java:filter():49] Will instrument the response
2023-07-18 13:30:02.296 1 DEBUG [ObservedResponseHttpHeadersFilter.java:filter():53] The response was handled for observation {name=http.client.requests(null), error=null, context=name='http.client.requests', contextualName='null', error='null', lowCardinalityKeyValues=[http.method='GET', http.status_code='UNKNOWN', spring.cloud.gateway.route.id='get', spring.cloud.gateway.route.uri='http://127.0.0.1:80'], highCardinalityKeyValues=[http.uri='/get'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@6a7a7d49', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.011380749, duration(nanos)=1.1380749E7, startTimeNanos=13196234625658183}'], parentObservation={name=http.server.requests(null), error=null, context=name='http.server.requests', contextualName='null', error='null', lowCardinalityKeyValues=[exception='none', method='GET', outcome='SUCCESS', status='200', uri='UNKNOWN'], highCardinalityKeyValues=[http.url='/api/get'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@3a8a910f', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.023711707, duration(nanos)=2.3711707E7, startTimeNanos=13196234613339659}'], parentObservation=null}}
2023-07-18 13:30:02.306 1 DEBUG [DefaultGlobalFilter.java:lambda$filter$5():89] status=[RESPONSE] key=[api-key] request_id=[request-id-1] host=[api.test.com] client_ip=[123.456.789.11] method=[GET] user_agent=[Mozilla/5.0 (Linux; Android 13; SM-S908N Build/TP1A.220624.014; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/104.0.5112.97 Mobile Safari/537.36Morpheus/NT] accept=[*/*] content_type=[*/*] service=[API_GET] url=[/api/get] http_status=[200]
2023-07-18 13:30:02.306 1 INFO  [DefaultGlobalFilter.java:lambda$filter$5():90] GlobalFilter End <<< request_id=[request-id-1]
2023-07-18 13:30:12.353 1 DEBUG [RoutePredicateHandlerMapping.java:lambda$lookupRoute$7():146] Route matched: get-post
2023-07-18 13:30:12.353 1 DEBUG [RoutePredicateHandlerMapping.java:lambda$getHandlerInternal$0():93] Mapping [Exchange: GET http://[0:0:0:0:0:0:0:1%0]:8080/api/get-post?key=api-master-key&parameter=value] to Route{id='get-post', uri=http://127.0.0.1:8082, order=0, predicate=(Paths: [/api/post], match trailing slash: true && Methods: [OPTIONS, GET]), gatewayFilters=[[ModifyResponseBody New content type = [null], In class = AroundPoiSearchResponse, Out class = String], [com.test.api.filters.factory.RequestLimiterGatewayFilterFactory$$Lambda$1236/0x00000008014042f8@22a80228, order = 1], [com.test.api.filters.factory.ValidationGatewayFilterFactory$$Lambda$1238/0x0000000801405af0@46a205e7, order = 1], [[RemoveRequestParameters name = 'key'], order = 2], [com.test.api.filters.factory.NearBySearchGatewayFilterFactory$$Lambda$1242/0x0000000801406728@217fae3d, order = 2], [[RemoveRequestParameters name = 'limited'], order = 3], [[RemoveRequestParameters name = 'beginIndex'], order = 4], [[DedupeResponseHeader Access-Control-Allow-Origin Access-Control-Allow-Credentials = RETAIN_FIRST], order = 5], metadata={}}
2023-07-18 13:30:12.353 1 DEBUG [AbstractHandlerMapping.java:lambda$getHandler$1():189] [request-id-2] Mapped to org.springframework.cloud.gateway.handler.FilteringWebHandler@4d3e62db
2023-07-18 13:30:12.353 1 DEBUG [FilteringWebHandler.java:handle():85] Sorted gatewayFilterFactories: [[GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.RemoveCachedBodyFilter@2503ec73}, order = -2147483648], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@20f6f88c}, order = -2147482648], [GatewayFilterAdapter{delegate=com.test.api.filters.AuthorizationFilter@53a7a60c}, order = -4], [GatewayFilterAdapter{delegate=com.test.api.filters.DefaultGlobalFilter@28bdbe88}, order = -3], [GatewayFilterAdapter{delegate=com.test.api.filters.OptionFilter@6a87026}, order = -2], [ModifyResponseBody New content type = [null], In class = AroundPoiSearchResponse, Out class = String], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@600f5704}, order = -1], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.ForwardPathFilter@44b21f9f}, order = 0], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.GatewayMetricsFilter@6296474f}, order = 0], [com.test.api.filters.factory.RequestLimiterGatewayFilterFactory$$Lambda$1236/0x00000008014042f8@22a80228, order = 1], [com.test.api.filters.factory.ValidationGatewayFilterFactory$$Lambda$1238/0x0000000801405af0@46a205e7, order = 1], [[RemoveRequestParameters name = 'key'], order = 2], [com.test.api.filters.factory.NearBySearchGatewayFilterFactory$$Lambda$1242/0x0000000801406728@217fae3d, order = 2], [[RemoveRequestParameters name = 'limited'], order = 3], [[RemoveRequestParameters name = 'beginIndex'], order = 4], [[DedupeResponseHeader Access-Control-Allow-Origin Access-Control-Allow-Credentials = RETAIN_FIRST], order = 5], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@606f81b5}, order = 10000], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.config.GatewayNoLoadBalancerClientAutoConfiguration$NoLoadBalancerClientFilter@4288d98e}, order = 10150], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ee8130e}, order = 2147483646], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@ef60710}, order = 2147483647], [GatewayFilterAdapter{delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@5e1fc42f}, order = 2147483647]]
2023-07-18 13:30:12.362 1 INFO  [DefaultGlobalFilter.java:filter():46] GlobalFilter Start >>> request_id=[request-id-2]
2023-07-18 13:30:12.362 1 DEBUG [DefaultGlobalFilter.java:lambda$filter$3():68] status=[REQUEST] key=[api-master-key] request_id=[request-id-2] host=[api.test.com] client_ip=[123.456.789.12] method=[GET] user_agent=[Mozilla/5.0 (Linux; Android 13; SM-G991N Build/TP1A.220624.014;) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/111.0.5563.58 Mobile Safari/537.36 android/GA_Android/_ga_cid=null;_ga_adid=null;; android/GA_Android/_ga_adid=00000000-0000-0000-0000-000000000000;_ga_cid=gacid;;] accept=[*/*] content_type=[*/*] service=[API_POST] url=[/api/get-post] http_status=[100] data=[{"key":"api-master-key","parameter":"value","location":"37.5557651,126.9458323"}]
2023-07-18 13:30:12.363 1 DEBUG [RedisRequestLimiter.java:lambda$isAllowed$2():52] allowed: true, tokensLeft: -1
2023-07-18 13:30:12.366 1 DEBUG [ObservedRequestHttpHeadersFilter.java:filter():64] Will instrument the HTTP request headers [host:"api.test.com", accept:"*/*", user-agent:"Mozilla/5.0 (Linux; Android 13; SM-G991N Build/TP1A.220624.014;) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/111.0.5563.58 Mobile Safari/537.36 android/GA_Android/_ga_cid=null;_ga_adid=null;; android/GA_Android/_ga_adid=00000000-0000-0000-0000-000000000000;_ga_cid=gacid;;", origin:"http://api.test.com", x-requested-with:"com.test.api", sec-fetch-site:"cross-site", sec-fetch-mode:"cors", sec-fetch-dest:"empty", referer:"http://api.test.com/", accept-encoding:"gzip, deflate", accept-language:"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7", x-request-id:"request-id-2", Content-Type:"application/json", Content-Length:"137", Forwarded:"proto=null;host=api.test.com;for="[0:0:0:0:0:0:0:1%0]:49988"", X-Forwarded-For:"123.456.789.12, 123.456.789.12,0:0:0:0:0:0:0:1%0", X-Forwarded-Port:"80"]
2023-07-18 13:30:12.366 1 DEBUG [ObservedRequestHttpHeadersFilter.java:filter():76] Client observation  {name=http.client.requests(null), error=null, context=name='http.client.requests', contextualName='null', error='null', lowCardinalityKeyValues=[http.method='POST', http.status_code='UNKNOWN', spring.cloud.gateway.route.id='get-post', spring.cloud.gateway.route.uri='http://127.0.0.1:8082'], highCardinalityKeyValues=[http.uri='/api/get-post?parameter/value'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@4122ff99', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=1.4637E-5, duration(nanos)=14637.0, startTimeNanos=13196244707144439}'], parentObservation={name=http.server.requests(null), error=null,context=name='http.server.requests', contextualName='null', error='null', lowCardinalityKeyValues=[exception='none', method='GET', outcome='SUCCESS', status='200', uri='UNKNOWN'], highCardinalityKeyValues=[http.url='/api/get-post'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@423d57f4', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.013641124, duration(nanos)=1.3641124E7, startTimeNanos=13196244693531616}'], parentObservation=null}} created for the request. New headers are [host:"api.test.com", accept:"*/*", user-agent:"Mozilla/5.0 (Linux; Android 13; SM-G991N Build/TP1A.220624.014;) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/111.0.5563.58 Mobile Safari/537.36 android/GA_Android/_ga_cid=null;_ga_adid=null;; android/GA_Android/_ga_adid=00000000-0000-0000-0000-000000000000;_ga_cid=gacid;;", origin:"http://api.test.com", x-requested-with:"com.test.api", sec-fetch-site:"cross-site", sec-fetch-mode:"cors", sec-fetch-dest:"empty", referer:"http://api.test.com/", accept-encoding:"gzip, deflate", accept-language:"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7", x-request-id:"request-id-2", Content-Type:"application/json", Content-Length:"137", Forwarded:"proto=null;host=api.test.com;for="[0:0:0:0:0:0:0:1%0]:49988"", X-Forwarded-For:"123.456.789.12, 123.456.789.12,0:0:0:0:0:0:0:1%0", X-Forwarded-Port:"80"]
2023-07-18 13:30:12.384 1 DEBUG [ObservedResponseHttpHeadersFilter.java:filter():49] Will instrument the response
2023-07-18 13:30:12.384 1 DEBUG [ObservedResponseHttpHeadersFilter.java:filter():53] The response was handled for observation {name=http.client.requests(null), error=null, context=name='http.client.requests', contextualName='null', error='null', lowCardinalityKeyValues=[http.method='POST', http.status_code='UNKNOWN', spring.cloud.gateway.route.id='get-post', spring.cloud.gateway.route.uri='http://127.0.0.1:8082'], highCardinalityKeyValues=[http.uri='/api/get-post?parameter/value'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@4122ff99', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.017925157, duration(nanos)=1.7925157E7, startTimeNanos=13196244707144439}'], parentObservation={name=http.server.requests(null), error=null, context=name='http.server.requests', contextualName='null', error='null', lowCardinalityKeyValues=[exception='none', method='GET', outcome='SUCCESS', status='200', uri='UNKNOWN'], highCardinalityKeyValues=[http.url='/api/get-post'], map=[class io.micrometer.core.instrument.Timer$Sample='io.micrometer.core.instrument.Timer$Sample@423d57f4', class io.micrometer.core.instrument.LongTaskTimer$Sample='SampleImpl{duration(seconds)=0.031550467, duration(nanos)=3.1550467E7, startTimeNanos=13196244693531616}'], parentObservation=null}}
2023-07-18 13:30:12.385 1 DEBUG [DefaultGlobalFilter.java:lambda$filter$5():89] status=[RESPONSE] key=[api-master-key] request_id=[request-id-2] host=[api.test.com] client_ip=[123.456.789.12] method=[GET] user_agent=[Mozilla/5.0 (Linux; Android 13; SM-G991N Build/TP1A.220624.014;) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/111.0.5563.58 Mobile Safari/537.36 android/GA_Android/_ga_cid=null;_ga_adid=null;; android/GA_Android/_ga_adid=00000000-0000-0000-0000-000000000000;_ga_cid=gacid;;] accept=[*/*] content_type=[*/*] service=[API_POST] url=[/api/get-post] http_status=[200] data=[{"status":"success","total":33,"result":"result-success"]
2023-07-18 13:30:12.385 1 INFO  [DefaultGlobalFilter.java:lambda$filter$5():90] GlobalFilter End <<< request_id=[request-id-2]
